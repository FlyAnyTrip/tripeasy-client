"use strict";(self.webpackChunktravel_package=self.webpackChunktravel_package||[]).push([[905],{4227:(e,s,a)=>{a.d(s,{bO:()=>i});const r="http://localhost:5000",i={getAllPackages:`${r}/api/packages`,getPackageById:e=>`${r}/api/packages/${e}`,createBooking:`${r}/api/bookings`,createBookingRequest:`${r}/api/booking-requests`,createCustomPackageRequest:`${r}/api/submit-custom-package`,getDestinations:`${r}/api/destinations`,createOrder:`${r}/api/create-order`,verifyPayment:e=>`${r}/api/verify-payment/${e}`,saveBooking:`${r}/api/save-booking`,sendReceipt:`${r}/api/send-receipt`,generateReceipt:`${r}/api/generate-receipt`,healthCheck:`${r}/api/ha`,getAllBookings:`${r}/api/admin/bookings`,getBookingById:e=>`${r}/api/bookings/${e}`,adminPackages:`${r}/api/admin/packages`,adminPackageById:e=>`${r}/api/admin/packages/${e}`}},4619:(e,s,a)=>{a.d(s,{A:()=>c});var r=a(5043),i=a(579);const c=function(e){let{children:s,animation:a="fade-up",delay:c=0,duration:n=800,threshold:t=.2,className:l="",once:o=!0}=e;const[p,m]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),h=(0,r.useRef)(null);(0,r.useEffect)((()=>{const e=h.current;if(!e)return;const s=new IntersectionObserver((e=>{const[s]=e;if(s.isIntersecting){if(o&&d)return;m(!0),u(!0)}else o||m(!1)}),{threshold:t,rootMargin:"0px"});return s.observe(e),()=>{e&&s.unobserve(e)}}),[t,o,d]);const y={animationDelay:`${c}ms`,animationDuration:`${n}ms`};return(0,i.jsx)("div",{ref:h,className:`animated-element ${a} ${p?"animate":""} ${l}`,style:y,children:s})}},8636:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var r=a(5043),i=a(3216),c=a(5475),n=a(4619),t=a(7221);const l=a.p+"static/media/cashfree-logo.5383fdd43b9b74851c9d.png";var o=a(4227),p=a(579);const m=function(){const{id:e}=(0,i.g)(),s=(0,i.zy)(),a=(0,i.Zp)(),{bookingDetails:m,packageDetails:d,totalPrice:u}=s.state||{},[h,y]=(0,r.useState)({processing:!1,success:!1,error:!1,message:""}),[f,j]=(0,r.useState)(!1),[x,g]=(0,r.useState)(""),[N,v]=(0,r.useState)("info"),[b,k]=(0,r.useState)(""),[$,w]=(0,r.useState)(null),[P,S]=(0,r.useState)(!1),[C,I]=(0,r.useState)(!1),D=()=>{S(!P)};(0,r.useEffect)((()=>{if(window.scrollTo({top:0,behavior:"smooth"}),!m||!d)return void a(`/package/${e}`);C&&(console.log("Detected return from payment gateway, resetting payment status"),I(!1),y({processing:!1,success:!1,error:!1,message:""}),document.body.classList.remove("pp-body-blur"));const s=new URLSearchParams(window.location.search).get("order_id");return s&&L(s),()=>{document.body.classList.remove("pp-body-blur")}}),[m,d,e,a,C]),(0,r.useEffect)((()=>{const e=()=>{y({processing:!1,success:!1,error:!1,message:""}),document.body.classList.remove("pp-body-blur")};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}}),[]);const L=async s=>{document.body.classList.add("pp-body-blur"),y({processing:!0,success:!1,error:!1,message:"Verifying payment..."});try{const r=await fetch(`${o.bO.createBookingRequest.replace("/api/booking-requests","/api/verify-payment")}/${s}`,{method:"GET",headers:{"Content-Type":"application/json","x-api-version":"2023-08-01"}}),i=await r.json();if(!r.ok)throw console.error("[v0] Payment verification error:",i),document.body.classList.remove("pp-body-blur"),new Error("Payment verification failed");if("PAID"===i.status){if(!b){const s=`TP${e}B${Math.floor(1e4*Math.random())}`;k(s)}m&&d&&(console.log("[v0] Storing booking details in sessionStorage before redirect"),sessionStorage.setItem("currentPackageId",e),sessionStorage.setItem(`bookingDetails_${e}`,JSON.stringify(m)),sessionStorage.setItem(`packageDetails_${e}`,JSON.stringify(d)),sessionStorage.setItem(`totalPrice_${e}`,JSON.stringify(u))),document.body.classList.remove("pp-body-blur"),y({processing:!1,success:!0,error:!1,message:"Payment successful! Your booking is confirmed."}),g("Payment successful! Your booking is confirmed."),v("success"),j(!0);const r=encodeURIComponent(JSON.stringify(m)),i=encodeURIComponent(JSON.stringify(d));setTimeout((()=>{a(`/payment-status?order_id=${s}&bookingData=${r}&packageData=${i}`)}),1500)}else document.body.classList.remove("pp-body-blur"),y({processing:!1,success:!1,error:!0,message:`Payment not successful. Status: ${i.status}`}),g(`Payment not successful. Status: ${i.status}`),v("error"),j(!0)}catch(r){console.error("[v0] Error verifying payment:",r),document.body.classList.remove("pp-body-blur"),y({processing:!1,success:!1,error:!0,message:"Payment verification failed. Please contact support."}),g("Payment verification failed. Please contact support."),v("error"),j(!0)}};return m&&d?(0,p.jsxs)("div",{className:"pp-payment-page",children:[(0,p.jsx)("div",{className:"pp-payment-header",children:(0,p.jsx)("div",{className:"container",children:(0,p.jsxs)(n.A,{animation:"fade-up",children:[(0,p.jsx)("h1",{className:"pp-page-title",children:"Payment"}),(0,p.jsxs)("p",{className:"pp-page-subtitle",children:["Complete your booking for ",d.name]})]})})}),(0,p.jsx)("div",{className:"container",children:h.success?(0,p.jsxs)("div",{className:"pp-payment-success",children:[(0,p.jsx)("div",{className:"pp-success-icon pp-animated-success-icon",children:(0,p.jsx)("i",{className:"fas fa-check-circle"})}),(0,p.jsx)("h2",{children:"Booking Confirmed!"}),(0,p.jsxs)("p",{children:["Your payment of \u20b9",u.toLocaleString("en-IN")," has been processed successfully."]}),(0,p.jsxs)("p",{children:["A confirmation email has been sent to ",m.email,"."]}),(0,p.jsxs)("p",{children:["Your booking reference: ",(0,p.jsx)("strong",{children:b})]}),(0,p.jsxs)("div",{className:"pp-success-actions",children:[(0,p.jsxs)(c.N_,{to:"/",className:"pp-home-button",children:[(0,p.jsx)("i",{className:"fas fa-home"})," Return to Home"]}),(0,p.jsxs)(c.N_,{to:"/packages",className:"pp-browse-button",children:[(0,p.jsx)("i",{className:"fas fa-search"})," Browse More Packages"]})]})]}):(0,p.jsxs)("div",{className:"pp-payment-container",children:[(0,p.jsx)(n.A,{animation:"fade-up",delay:100,children:(0,p.jsxs)("div",{className:"pp-order-summary",children:[(0,p.jsxs)("div",{className:"pp-order-summary-header",children:[(0,p.jsx)("i",{className:"fas fa-receipt pp-summary-icon"}),(0,p.jsx)("h2",{className:"pp-summary-title",children:"Order Summary"})]}),(0,p.jsxs)("div",{className:"pp-summary-details",children:[(0,p.jsxs)("div",{className:"pp-summary-item",children:[(0,p.jsxs)("div",{className:"pp-summary-item-icon-wrapper",children:[(0,p.jsx)("i",{className:"fas fa-map-marked-alt pp-summary-item-icon"}),(0,p.jsx)("span",{className:"pp-summary-label",children:"Package:"})]}),(0,p.jsx)("span",{className:"pp-summary-value",children:d.name})]}),(0,p.jsxs)("div",{className:"pp-summary-item",children:[(0,p.jsxs)("div",{className:"pp-summary-item-icon-wrapper",children:[(0,p.jsx)("i",{className:"fas fa-map-marker-alt pp-summary-item-icon"}),(0,p.jsx)("span",{className:"pp-summary-label",children:"Destination:"})]}),(0,p.jsx)("span",{className:"pp-summary-value",children:d.location})]}),(0,p.jsxs)("div",{className:"pp-summary-item",children:[(0,p.jsxs)("div",{className:"pp-summary-item-icon-wrapper",children:[(0,p.jsx)("i",{className:"fas fa-calendar-alt pp-summary-item-icon"}),(0,p.jsx)("span",{className:"pp-summary-label",children:"Duration:"})]}),(0,p.jsxs)("span",{className:"pp-summary-value",children:[d.duration," Days"]})]}),(0,p.jsxs)("div",{className:"pp-summary-item",children:[(0,p.jsxs)("div",{className:"pp-summary-item-icon-wrapper",children:[(0,p.jsx)("i",{className:"fas fa-calendar-day pp-summary-item-icon"}),(0,p.jsx)("span",{className:"pp-summary-label",children:"Travel Date:"})]}),(0,p.jsx)("span",{className:"pp-summary-value",children:m.travelDate})]}),(0,p.jsxs)("div",{className:"pp-summary-item",children:[(0,p.jsxs)("div",{className:"pp-summary-item-icon-wrapper",children:[(0,p.jsx)("i",{className:"fas fa-users pp-summary-item-icon"}),(0,p.jsx)("span",{className:"pp-summary-label",children:"Travelers:"})]}),(0,p.jsx)("span",{className:"pp-summary-value",children:m.travelers})]}),(0,p.jsxs)("div",{className:"pp-summary-item",children:[(0,p.jsxs)("div",{className:"pp-summary-item-icon-wrapper",children:[(0,p.jsx)("i",{className:"fas fa-tag pp-summary-item-icon"}),(0,p.jsx)("span",{className:"pp-summary-label",children:"Price per person:"})]}),(0,p.jsxs)("span",{className:"pp-summary-value",children:["\u20b9",d.price.toLocaleString("en-IN")]})]}),(0,p.jsxs)("div",{className:"pp-summary-item pp-total",children:[(0,p.jsxs)("div",{className:"pp-summary-item-icon-wrapper",children:[(0,p.jsx)("i",{className:"fas fa-money-bill-wave pp-summary-item-icon"}),(0,p.jsx)("span",{className:"pp-summary-label",children:"Total Amount:"})]}),(0,p.jsxs)("span",{className:"pp-summary-value",children:["\u20b9",u.toLocaleString("en-IN")]})]})]}),(0,p.jsxs)("div",{className:"pp-customer-details",children:[(0,p.jsxs)("h3",{children:[(0,p.jsx)("i",{className:"fas fa-user-circle pp-customer-icon"})," Customer Details"]}),(0,p.jsxs)("div",{className:"pp-customer-info",children:[(0,p.jsxs)("div",{className:"pp-customer-info-item",children:[(0,p.jsx)("i",{className:"fas fa-user"}),(0,p.jsx)("span",{children:m.fullName})]}),(0,p.jsxs)("div",{className:"pp-customer-info-item",children:[(0,p.jsx)("i",{className:"fas fa-envelope"}),(0,p.jsx)("span",{children:m.email})]}),(0,p.jsxs)("div",{className:"pp-customer-info-item",children:[(0,p.jsx)("i",{className:"fas fa-phone"}),(0,p.jsx)("span",{children:m.phone})]}),(0,p.jsxs)("button",{className:"pp-view-details-button",onClick:D,children:[(0,p.jsx)("i",{className:"fas fa-users"})," View All Travelers"]})]})]})]})}),(0,p.jsx)(n.A,{animation:"fade-up",delay:200,children:(0,p.jsxs)("div",{className:"pp-payment-form-container",children:[(0,p.jsxs)("h2",{className:"pp-form-title",children:[(0,p.jsx)("i",{className:"fas fa-credit-card pp-form-icon"})," Payment Method"]}),(0,p.jsxs)("div",{className:"pp-cashfree-info",children:[(0,p.jsxs)("div",{className:"pp-cashfree-logo",children:[(0,p.jsx)("img",{src:l||"",alt:"Cashfree",className:"pp-cashfree-logo-img"}),(0,p.jsx)("span",{children:"Cashfree Payments"})]}),(0,p.jsx)("p",{children:"Secure payments powered by Cashfree. You'll be redirected to Cashfree's secure payment page to complete your transaction."}),(0,p.jsxs)("div",{className:"pp-payment-methods-supported",children:[(0,p.jsx)("p",{children:"Supported payment methods:"}),(0,p.jsxs)("div",{className:"pp-payment-icons",children:[(0,p.jsxs)("div",{className:"pp-payment-icon",children:[(0,p.jsx)("i",{className:"fas fa-credit-card",title:"Credit/Debit Cards"}),(0,p.jsx)("span",{children:"Cards"})]}),(0,p.jsxs)("div",{className:"pp-payment-icon",children:[(0,p.jsx)("i",{className:"fas fa-mobile-alt",title:"UPI"}),(0,p.jsx)("span",{children:"UPI"})]}),(0,p.jsxs)("div",{className:"pp-payment-icon",children:[(0,p.jsx)("i",{className:"fas fa-university",title:"Net Banking"}),(0,p.jsx)("span",{children:"Net Banking"})]}),(0,p.jsxs)("div",{className:"pp-payment-icon",children:[(0,p.jsx)("i",{className:"fas fa-wallet",title:"Wallets"}),(0,p.jsx)("span",{children:"Wallets"})]})]})]})]}),(0,p.jsxs)("div",{className:"pp-secure-payment-info",children:[(0,p.jsx)("i",{className:"fas fa-shield-alt"}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{children:"Secure Payment"}),(0,p.jsx)("p",{children:"Your payment information is secure. We use industry-standard encryption to protect your data."})]})]}),(0,p.jsxs)("div",{className:"pp-form-actions",children:[(0,p.jsxs)(c.N_,{to:`/booking/${e}`,className:"pp-back-link",children:[(0,p.jsx)("i",{className:"fas fa-arrow-left"})," Back to Booking"]}),(0,p.jsxs)("button",{type:"button",className:"pp-pay-button",onClick:async()=>{document.body.classList.add("pp-body-blur"),y({processing:!0,success:!1,error:!1,message:"Preparing your payment..."}),sessionStorage.setItem("currentPackageId",e),sessionStorage.setItem(`bookingDetails_${e}`,JSON.stringify(m)),sessionStorage.setItem(`packageDetails_${e}`,JSON.stringify(d)),sessionStorage.setItem(`totalPrice_${e}`,JSON.stringify(u));const s=await(async()=>{y({processing:!0,success:!1,error:!1,message:"Creating payment order..."});try{const s=`TP${e}B${Math.floor(1e4*Math.random())}`;k(s);const a=await fetch(`${o.bO.createBookingRequest.replace("/api/booking-requests","/api/create-order")}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:u,currency:"INR",customerDetails:{customer_id:`cust_${Date.now()}`,customer_name:m.fullName,customer_email:m.email,customer_phone:m.phone}})}),r=await a.json();if(!a.ok)throw console.error("[v0] Server error details:",r),document.body.classList.remove("pp-body-blur"),new Error(r.message||"Failed to create order");return w(r),r}catch(s){return console.error("[v0] Error creating order:",s),document.body.classList.remove("pp-body-blur"),y({processing:!1,success:!1,error:!0,message:"Failed to create payment order. Please try again."}),g("Failed to create payment order. Please try again."),v("error"),j(!0),null}})();if(s)if(I(!0),window.Cashfree){const e=new window.Cashfree(s.payment_session_id),a=encodeURIComponent(JSON.stringify(m)),r=encodeURIComponent(JSON.stringify(d));e.redirect({params:{bookingData:a,packageData:r}})}else console.error("Cashfree SDK not loaded"),document.body.classList.remove("pp-body-blur"),y({processing:!1,success:!1,error:!0,message:"Payment gateway not available. Please try again later."}),g("Payment gateway not available. Please try again later."),v("error"),j(!0),I(!1);else document.body.classList.remove("pp-body-blur")},disabled:h.processing,children:[h.processing?"Processing...":`Pay \u20b9${u.toLocaleString("en-IN")}`,!h.processing&&(0,p.jsx)("i",{className:"fas fa-lock"})]})]})]})})]})}),f&&(0,p.jsx)(t.A,{message:x,type:N,onClose:()=>j(!1)}),h.processing&&(0,p.jsx)("div",{className:"pp-centered-loader-overlay",children:(0,p.jsxs)("div",{className:"pp-centered-loader-container",children:[(0,p.jsx)("div",{className:"pp-centered-loader-spinner",children:(0,p.jsx)("div",{className:"pp-spinner-inner"})}),(0,p.jsx)("p",{children:h.message})]})}),P&&(0,p.jsx)("div",{className:"pp-customer-details-modal",children:(0,p.jsxs)("div",{className:"pp-modal-content",children:[(0,p.jsxs)("div",{className:"pp-modal-header",style:{position:"sticky",top:0,backgroundColor:"white",zIndex:10},children:[(0,p.jsxs)("h3",{children:[(0,p.jsx)("i",{className:"fas fa-users"})," All Travelers"]}),(0,p.jsx)("button",{className:"pp-modal-close",onClick:D,children:(0,p.jsx)("i",{className:"fas fa-times"})})]}),(0,p.jsx)("div",{className:"pp-modal-body",children:(0,p.jsxs)("div",{className:"pp-traveler-cards",children:[(0,p.jsxs)("div",{className:"pp-traveler-card pp-primary-traveler",children:[(0,p.jsxs)("div",{className:"pp-traveler-card-header",children:[(0,p.jsx)("i",{className:"fas fa-user-circle"}),(0,p.jsx)("h4",{children:"Primary Traveler"})]}),(0,p.jsxs)("div",{className:"pp-traveler-card-body",children:[(0,p.jsxs)("div",{className:"pp-traveler-detail",children:[(0,p.jsx)("i",{className:"fas fa-user"}),(0,p.jsx)("span",{children:m.fullName})]}),(0,p.jsxs)("div",{className:"pp-traveler-detail",children:[(0,p.jsx)("i",{className:"fas fa-envelope"}),(0,p.jsx)("span",{children:m.email})]}),(0,p.jsxs)("div",{className:"pp-traveler-detail",children:[(0,p.jsx)("i",{className:"fas fa-phone"}),(0,p.jsx)("span",{children:m.phone})]}),(0,p.jsxs)("div",{className:"pp-traveler-detail",children:[(0,p.jsx)("i",{className:"fas fa-venus-mars"}),(0,p.jsx)("span",{children:m.gender})]}),(0,p.jsxs)("div",{className:"pp-traveler-detail",children:[(0,p.jsx)("i",{className:"fas fa-birthday-cake"}),(0,p.jsxs)("span",{children:[m.age," years"]})]})]})]}),m.additionalTravelers&&m.additionalTravelers.map(((e,s)=>(0,p.jsxs)("div",{className:"pp-traveler-card",children:[(0,p.jsxs)("div",{className:"pp-traveler-card-header",children:[(0,p.jsx)("i",{className:"fas fa-user"}),(0,p.jsxs)("h4",{children:["Traveler ",s+2]})]}),(0,p.jsxs)("div",{className:"pp-traveler-card-body",children:[(0,p.jsxs)("div",{className:"pp-traveler-detail",children:[(0,p.jsx)("i",{className:"fas fa-user"}),(0,p.jsx)("span",{children:e.fullName})]}),(0,p.jsxs)("div",{className:"pp-traveler-detail",children:[(0,p.jsx)("i",{className:"fas fa-venus-mars"}),(0,p.jsx)("span",{children:e.gender})]}),(0,p.jsxs)("div",{className:"pp-traveler-detail",children:[(0,p.jsx)("i",{className:"fas fa-birthday-cake"}),(0,p.jsxs)("span",{children:[e.age," years"]})]})]})]},s)))]})})]})})]}):(0,p.jsxs)("div",{className:"pp-loading-container",children:[(0,p.jsx)("div",{className:"pp-loading-spinner"}),(0,p.jsx)("p",{children:"Loading payment page..."})]})}}}]);
//# sourceMappingURL=905.3882c633.chunk.js.map